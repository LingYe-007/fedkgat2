# 数据集准备指南

## 📊 需要的数据集

项目支持三个数据集：**Music (Last.fm)**, **Book (Book-Crossing)**, **Movie (MovieLens-20M)**

## 📁 数据集目录结构

每个数据集需要放在对应的目录下：

### 1. Music 数据集 (Last.fm)
```
data/music/
├── item_index2entity_id.txt      # 物品ID到实体ID的映射
├── kg_final.txt                  # 知识图谱三元组
└── ratings_final.txt             # 用户评分数据
```

**文件格式**：
- `item_index2entity_id.txt`: `item_id\tentity_id`
- `kg_final.txt`: `head_entity\trelation\ttail_entity`
- `ratings_final.txt`: `user_id\titem_id\trating` (分隔符: `\t`)

---

### 2. Book 数据集 (Book-Crossing)
```
data/book/
├── item_index2entity_id_rehashed.txt  # 物品ID到实体ID的映射
├── kg_rehashed.txt                     # 知识图谱三元组
└── BX-Book-Ratings.csv                 # 用户评分数据
```

**文件格式**：
- `item_index2entity_id_rehashed.txt`: `item_id\tentity_id`
- `kg_rehashed.txt`: `head_entity\trelation\ttail_entity`
- `BX-Book-Ratings.csv`: `user_id;item_id;rating` (分隔符: `;`)

---

### 3. Movie 数据集 (MovieLens-20M)
```
data/movie/
├── item_index2entity_id.txt      # 物品ID到实体ID的映射
├── kg_final.txt                  # 知识图谱三元组
└── ratings_final.txt             # 用户评分数据
```

**文件格式**：
- `item_index2entity_id.txt`: `item_id\tentity_id`
- `kg_final.txt`: `head_entity\trelation\ttail_entity`
- `ratings_final.txt`: `user_id,item_id,rating` (分隔符: `,`)

---

## 🔍 数据集来源

### 1. Last.fm (Music)
- **来源**: [Last.fm Dataset](http://www.last.fm/api)
- **知识图谱**: 可以从 [Freebase](https://developers.google.com/freebase) 或 [DBpedia](https://www.dbpedia.org/) 获取

### 2. Book-Crossing
- **来源**: [Book-Crossing Dataset](http://www2.informatik.uni-freiburg.de/~cziegler/BX/)
- **知识图谱**: 从 Amazon Book 或 Freebase 获取

### 3. MovieLens-20M
- **来源**: [MovieLens 20M Dataset](https://grouplens.org/datasets/movielens/20m/)
- **知识图谱**: 从 [TMDB](https://www.themoviedb.org/) 或 [IMDb](https://www.imdb.com/) 获取

---

## 🛠️ 数据预处理

项目会自动进行数据预处理：
- 将原始数据转换为 PyTorch 张量
- 构建知识图谱邻接表
- 划分训练集和测试集（默认 8:2）
- 保存为 `preprocessed_data` 文件

**首次运行时会自动执行预处理，之后会直接加载预处理好的数据。**

---

## 📝 示例：创建测试数据集

如果你只是想测试代码是否能运行，可以创建一个小型的模拟数据集：

### 创建 Music 测试数据
```bash
mkdir -p data/music

# 创建 item_index2entity_id.txt (10个物品)
echo -e "0\t100\n1\t101\n2\t102\n3\t103\n4\t104\n5\t105\n6\t106\n7\t107\n8\t108\n9\t109" > data/music/item_index2entity_id.txt

# 创建 kg_final.txt (30个三元组)
echo -e "100\t0\t200\n101\t0\t201\n102\t1\t202\n103\t1\t203\n104\t2\t204\n105\t0\t205\n106\t1\t206\n107\t2\t207\n108\t0\t208\n109\t1\t209" > data/music/kg_final.txt

# 创建 ratings_final.txt (100条评分)
for i in {0..99}; do
  user=$((i % 20))
  item=$((i % 10))
  rating=$((RANDOM % 2))
  echo -e "$user\t$item\t$rating" >> data/music/ratings_final.txt
done
```

---

## ✅ 验证数据集

运行以下命令验证数据集是否正确：

```bash
# 检查文件是否存在
ls -lh data/music/

# 查看文件前几行
head -5 data/music/item_index2entity_id.txt
head -5 data/music/kg_final.txt
head -5 data/music/ratings_final.txt
```

---

## 🚀 运行项目

数据集准备好后，使用以下命令运行：

```bash
# Music 数据集
python run.py --arch kgcn --complex_arch master=kgcn_kg,worker=kgcn_aggregate \
  --experiment serial --data music --batch_size 32 --n_clients 10 \
  --n_comm_rounds 100 --local_n_epochs 1 --on_cuda True

# Book 数据集
python run.py --arch kgcn --complex_arch master=kgcn_kg,worker=kgcn_aggregate \
  --experiment serial --data book --batch_size 32 --n_clients 10 \
  --n_comm_rounds 100 --local_n_epochs 1 --on_cuda True

# Movie 数据集
python run.py --arch kgcn --complex_arch master=kgcn_kg,worker=kgcn_aggregate \
  --experiment serial --data movie --batch_size 32 --n_clients 10 \
  --n_comm_rounds 100 --local_n_epochs 1 --on_cuda True
```

---

## 📌 注意事项

1. **数据集大小**: 
   - Music/Book: 适合小规模实验（客户端数 < 2000）
   - Movie: 大规模数据集（客户端数 > 100,000）

2. **内存需求**:
   - 小数据集: 8GB+ RAM
   - 大数据集: 32GB+ RAM

3. **GPU需求**:
   - 推荐使用 NVIDIA GPU (CUDA 11.8+)
   - 最小显存: 6GB
   - 推荐显存: 12GB+

4. **预处理时间**:
   - 首次运行会进行数据预处理
   - Music/Book: 1-5分钟
   - Movie: 10-30分钟

---

## 🔗 相关资源

- [RippleNet](https://github.com/hwwang55/RippleNet) - 类似的知识图谱推荐项目
- [KGAT](https://github.com/xiangwang1223/knowledge_graph_attention_network) - 知识图谱注意力网络
- [FedRKG Paper](https://arxiv.org/abs/xxxx.xxxxx) - 原论文

---

**准备好数据集后，就可以开始训练了！** 🎉


